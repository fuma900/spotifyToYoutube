var services=angular.module("serviceModule",[]);services.service("Youtube",["$q","$window","Helper",function(e,t,i){this.clientId="743605158714-vfjtaobdqlgshs7157r43e1ohntdkbe6.apps.googleusercontent.com",this.scopes="https://www.googleapis.com/auth/youtube",this.setupApi=function(){gapi.client.setApiKey("AIzaSyBKB-CGWlr3id6q4SObfRPrYrAIHcACPuk"),t.setTimeout(this.checkAuth,1)},this.checkAuth=function(){var t=e.defer();return gapi.auth.authorize({client_id:this.clientId,scope:this.scopes,immediate:!0},function(e){t.resolve(e&&!e.error?!0:e?e.error:!1)}),t.promise},this.login=function(t){var i=e.defer();return gapi.auth.authorize({client_id:this.clientId,scope:this.scopes,immediate:!1},function(e){i.resolve(e&&!e.error?!0:e?e.error:!1)}),i.promise},this.createPlaylist=function(){var e=gapi.client.youtube.playlists.insert({part:"snippet,status",resource:{snippet:{title:"Test Playlist",description:"A private playlist created with the YouTube API"},status:{privacyStatus:"private"}}});e.execute(function(e){var t=e.result;return t?void(playlistId=t.id):!1})},this.loadApi=function(e){gapi.client?gapi.client.youtube?e():gapi.client.load("youtube","v3",function(){e()}):(i.sleep(2e3),console.info("waiting for Google API to be loaded"),this.loadApi(e))},this.searchVideo=function(t){var i=e.defer();return this.loadApi(function(){var e=t.artists+" "+t.name,r=gapi.client.youtube.search.list({q:e,part:"snippet"});r.then(function(e){i.resolve(e)})}),i.promise},this.searchVideos=function(t){var i=[];return angular.forEach(t,function(e){this.searchVideo(e).then(function(e){i.push(e)})}),e.when(i)}}]),services.service("Spotify",["$q","$http","Helper","Youtube",function(e,t,i,r){this.getTracks=function(e){var i=[],r=[],o=[];if(!(e.length>1e3)){if(e.length>50)for(var s=0,n=e.length;n>s;s+=50)i.push(e.slice(s,s+50));else i=[e];for(var a=0;a<i.length;a+=1)r.push(t.get("https://api.spotify.com/v1/tracks",{params:{ids:i[a].join()}}));return r}}}]),services.service("Helper",["$q",function(e){this.extractSpotifyId=function(e){var t=[];return e=e.split(/\n/),angular.forEach(e,function(e){var i=0,r=e.trim().split(":");if(i="http"===r[0]?1:"spotify"===r[0]?2:0,0===i)console.log("Url "+e.trim()+" is not valid!");else{var o=r[r.length-1].split("/");o=o[o.length-1],t.push(o)}}),t},this.getTracksInfo=function(t){var i=[];console.log(t);for(var r=0;r<t.length;r+=1)if(t[r]){for(var o=[],s=0;s<t[r].artists.length;s+=1)o.push(t[r].artists[s].name);o=o.join(", "),i.push({album:t[r].album,artists:o,name:t[r].name})}return e.when(i)},this.sleep=function(e){for(var t=(new Date).getTime(),i=0;1e7>i&&!((new Date).getTime()-t>e);i++);}}]),services.directive("youtube",function(e){return{restrict:"E",scope:{height:"@",width:"@",videoid:"="},template:"<div></div>",link:function(t,i){var r=document.createElement("script");r.src="https://www.youtube.com/iframe_api";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(r,o);var s;e.onYouTubeIframeAPIReady=function(){s=new YT.Player(i.children()[0],{playerVars:{autoplay:0,html5:1,theme:"light",modesbranding:1,color:"white",iv_load_policy:3,showinfo:1,controls:1},height:300,width:570})},t.$watch("videoid",function(e,i){e!=i&&(console.log(e),s.cuePlaylist({playlist:t.videoid}))}),t.$watch("height + width",function(e,i){e!=i&&s.setSize(t.width,t.height)})}}});