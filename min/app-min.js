function init(){window.init()}var app=angular.module("app",["serviceModule"]);app.controller("appCtrl",["$scope","$http","$q","$window","Youtube","Helper","Spotify",function(t,e,i,n,o,r,s){t.gapiReady=!1,t.isLoggedIn=!1,n.init=function(){o.setupApi(),t.gapiReady=!0,o.checkAuth().then(function(e){t.isLoggedIn=e===!0?!0:!1})},t.checkAuth=function(){o.checkAuth().then(function(e){t.isLoggedIn=e===!0?!0:!1})},t.login=function(){console.info("logging in"),o.login().then(function(e){e===!0&&(t.isLoggedIn=!0)})},t.addToPlaylist=function(){t.checkAuth()},t.reset=function(){t.urls="",t.results=[],t.youtubeIds=[]},t.run=function(){var e=[],n=[];if(""!==t.urls){var a=r.extractSpotifyId(t.urls),c=s.getTracks(a);i.all(c).then(function(t){angular.forEach(t,function(i,n){e=e.concat(t[n].data.tracks)})}).then(function(){return r.getTracksInfo(e)}).then(function(e){var r=[];angular.forEach(e,function(t,e){r.push(o.searchVideo(t))}),i.all(r).then(function(i){angular.forEach(e,function(t,o){e[o].youtubeId=i[o].result.items[0].id.videoId,n.push(e[o].youtubeId)}),t.results=e,t.youtubeIds=n})})}},t.urls="http://open.spotify.com/track/0ifSeVGUr7py5GggttDhXw \nhttp://open.spotify.com/track/6c6OMbNVGHxGZWGc9ubHwq \nhttp://open.spotify.com/track/6gp3RHhdZlrPGaf5qcgFSg \nhttp://open.spotify.com/track/7pNC5ZIKtwUK0ReSpM3P9f"}]);var services=angular.module("serviceModule",[]);services.service("Youtube",["$q","$window","Helper",function(t,e,i){this.clientId="743605158714-vfjtaobdqlgshs7157r43e1ohntdkbe6.apps.googleusercontent.com",this.scopes="https://www.googleapis.com/auth/youtube",this.setupApi=function(){gapi.client.setApiKey("AIzaSyBKB-CGWlr3id6q4SObfRPrYrAIHcACPuk"),e.setTimeout(this.checkAuth,1)},this.checkAuth=function(){var e=t.defer();return gapi.auth.authorize({client_id:this.clientId,scope:this.scopes,immediate:!0},function(t){e.resolve(t&&!t.error?!0:t?t.error:!1)}),e.promise},this.login=function(e){var i=t.defer();return gapi.auth.authorize({client_id:this.clientId,scope:this.scopes,immediate:!1},function(t){i.resolve(t&&!t.error?!0:t?t.error:!1)}),i.promise},this.createPlaylist=function(e){var i=t.defer(),n=gapi.client.youtube.playlists.insert({part:"snippet,status",resource:{snippet:{title:e,description:"A private playlist created with the YouTube API"},status:{privacyStatus:"private"}}});return n.execute(function(t){var e=t.result;i.resolve(e?e:!1)}),i.promise},this.addVideoToPlaylist=function(e,i){var n=t.defer(),o={videoId:id,kind:"youtube#video"},r=gapi.client.youtube.playlistItems.insert({part:"snippet",resource:{snippet:{playlistId:i,resourceId:o}}});return r.execute(function(t){n.resolve(result)}),n.promise},this.loadApi=function(t){gapi.client?gapi.client.youtube?t():gapi.client.load("youtube","v3",function(){t()}):(i.sleep(2e3),console.info("waiting for Google API to be loaded"),this.loadApi(t))},this.searchVideo=function(e){var i=t.defer();return this.loadApi(function(){var t=e.artists+" "+e.name,n=gapi.client.youtube.search.list({q:t,part:"id"});n.then(function(t){i.resolve(t)})}),i.promise},this.searchVideos=function(e){var i=[];return angular.forEach(e,function(t){this.searchVideo(t).then(function(t){i.push(t)})}),t.when(i)}}]),services.service("Spotify",["$q","$http","Helper","Youtube",function(t,e,i,n){this.getTracks=function(t){var i=[],n=[],o=[];if(!(t.length>1e3)){if(t.length>50)for(var r=0,s=t.length;s>r;r+=50)i.push(t.slice(r,r+50));else i=[t];for(var a=0;a<i.length;a+=1)n.push(e.get("https://api.spotify.com/v1/tracks",{params:{ids:i[a].join()}}));return n}}}]),services.service("Helper",["$q",function(t){this.extractSpotifyId=function(t){var e=[];return t=t.split(/\n/),angular.forEach(t,function(t){var i=0,n=t.trim().split(":");if(i="http"===n[0]?1:"spotify"===n[0]?2:0,0===i)console.log("Url "+t.trim()+" is not valid!");else{var o=n[n.length-1].split("/");o=o[o.length-1],e.push(o)}}),e},this.getTracksInfo=function(e){var i=[];console.log(e);for(var n=0;n<e.length;n+=1)if(e[n]){for(var o=[],r=0;r<e[n].artists.length;r+=1)o.push(e[n].artists[r].name);o=o.join(", "),i.push({album:e[n].album,artists:o,name:e[n].name,spotifyUrl:e[n].external_urls.spotify})}return t.when(i)},this.sleep=function(t){for(var e=(new Date).getTime(),i=0;1e7>i&&!((new Date).getTime()-e>t);i++);}}]),services.directive("youtube",["$window",function(t){return{restrict:"E",scope:{height:"@",width:"@",videoid:"="},template:"<div></div>",link:function(e,i){var n=document.createElement("script");n.src="https://www.youtube.com/iframe_api";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o);var r;t.onYouTubeIframeAPIReady=function(){r=new YT.Player(i.children()[0],{playerVars:{autoplay:1,html5:1,theme:"light",modesbranding:1,color:"white",iv_load_policy:3,showinfo:1,controls:1},height:300,width:570})},e.$watch("videoid",function(t,i){t!=i&&""!==t&&t!==[]&&(console.log(t),r.loadPlaylist({playlist:e.videoid}))}),e.$watch("height + width",function(t,i){t!=i&&r.setSize(e.width,e.height)})}}}]);